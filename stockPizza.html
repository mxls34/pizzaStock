<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stock ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&family=Prompt:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --white: #ffffff;
    --blue-50: #eff6ff;
    --blue-100: #dbeafe;
    --blue-200: #bfdbfe;
    --blue-300: #93c5fd;
    --blue-400: #60a5fa;
    --blue-500: #3b82f6;
    --blue-600: #2563eb;
    --blue-700: #1d4ed8;
    --blue-800: #1e40af;
    --blue-900: #1e3a8a;
    --shadow-sm: 0 1px 3px rgba(37,99,235,0.08), 0 1px 2px rgba(37,99,235,0.05);
    --shadow-md: 0 4px 16px rgba(37,99,235,0.10), 0 2px 6px rgba(37,99,235,0.06);
    --shadow-lg: 0 10px 32px rgba(37,99,235,0.14), 0 4px 12px rgba(37,99,235,0.08);
    --shadow-xl: 0 20px 48px rgba(37,99,235,0.18), 0 8px 20px rgba(37,99,235,0.10);
    --radius: 16px;
    --radius-sm: 10px;
    --radius-xs: 6px;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Sarabun', sans-serif;
    background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 40%, #bfdbfe 100%);
    min-height: 100vh;
    color: #1e3a8a;
  }

  /* HEADER */
  .header {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 60%, #1e40af 100%);
    padding: 0 clamp(16px, 4vw, 48px);
    box-shadow: var(--shadow-lg);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header-inner {
    max-width: 1400px;
    margin: 0 auto;
    display: flex;
    align-items: center;
    justify-content: space-between;
    height: 64px;
    gap: 16px;
  }

  .header-title {
    font-family: 'Prompt', sans-serif;
    font-size: clamp(16px, 2.5vw, 22px);
    font-weight: 600;
    color: #fff;
    letter-spacing: 0.01em;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .header-title .icon {
    width: 36px; height: 36px;
    background: rgba(255,255,255,0.2);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px;
  }

  .btn-add-main {
    background: rgba(255,255,255,0.15);
    border: 1.5px solid rgba(255,255,255,0.4);
    color: #fff;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    font-weight: 600;
    padding: 8px 18px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    display: flex; align-items: center; gap: 7px;
    transition: all 0.2s;
    white-space: nowrap;
    backdrop-filter: blur(8px);
  }
  .btn-add-main:hover {
    background: rgba(255,255,255,0.28);
    transform: translateY(-1px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.15);
  }

  /* MAIN */
  .main {
    max-width: 1400px;
    margin: 0 auto;
    padding: clamp(16px, 3vw, 32px) clamp(12px, 3vw, 48px);
  }

  /* STATS */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }

  .stat-card {
    background: #fff;
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-md);
    display: flex;
    flex-direction: column;
    gap: 6px;
    border: 1.5px solid var(--blue-100);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .stat-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }

  .stat-label {
    font-size: 12px;
    font-weight: 500;
    color: var(--blue-400);
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  .stat-value {
    font-family: 'Prompt', sans-serif;
    font-size: clamp(24px, 4vw, 34px);
    font-weight: 700;
    color: var(--blue-700);
    line-height: 1;
  }

  .stat-card.normal .stat-value { color: #16a34a; }
  .stat-card.low .stat-value { color: #d97706; }
  .stat-card.outstock .stat-value { color: #dc2626; }

  /* SEARCH */
  .search-panel {
    background: #fff;
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow-md);
    border: 1.5px solid var(--blue-100);
    margin-bottom: 24px;
  }

  .search-panel-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--blue-600);
    margin-bottom: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .search-row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
    align-items: flex-end;
  }

  .search-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
    flex: 1;
    min-width: 140px;
  }

  .search-group label {
    font-size: 12px;
    font-weight: 600;
    color: var(--blue-500);
    letter-spacing: 0.04em;
  }

  .search-input, .search-select {
    border: 1.5px solid var(--blue-200);
    border-radius: var(--radius-sm);
    padding: 9px 14px;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    color: var(--blue-900);
    background: var(--blue-50);
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    width: 100%;
  }
  .search-input:focus, .search-select:focus {
    border-color: var(--blue-400);
    box-shadow: 0 0 0 3px rgba(96,165,250,0.2);
    background: #fff;
  }

  .btn-search {
    background: linear-gradient(135deg, var(--blue-500), var(--blue-700));
    color: #fff;
    border: none;
    border-radius: var(--radius-sm);
    padding: 9px 22px;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    display: flex; align-items: center; gap: 6px;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s;
    white-space: nowrap;
    height: fit-content;
    align-self: flex-end;
  }
  .btn-search:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: var(--shadow-md); }

  .btn-clear {
    background: var(--blue-100);
    color: var(--blue-600);
    border: 1.5px solid var(--blue-200);
    border-radius: var(--radius-sm);
    padding: 9px 16px;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    height: fit-content;
    align-self: flex-end;
  }
  .btn-clear:hover { background: var(--blue-200); }

  /* TABLE */
  .table-panel {
    background: #fff;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    border: 1.5px solid var(--blue-100);
    overflow: hidden;
  }

  .table-header-bar {
    padding: 16px 20px;
    border-bottom: 1.5px solid var(--blue-100);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }

  .table-header-bar h2 {
    font-family: 'Prompt', sans-serif;
    font-size: 15px;
    font-weight: 600;
    color: var(--blue-800);
  }

  .result-count {
    font-size: 12px;
    color: var(--blue-400);
    background: var(--blue-50);
    padding: 4px 12px;
    border-radius: 20px;
    border: 1px solid var(--blue-200);
  }

  .table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    min-width: 700px;
  }

  thead tr {
    background: linear-gradient(135deg, var(--blue-50), var(--blue-100));
  }

  th {
    padding: 12px 16px;
    text-align: left;
    font-size: 11px;
    font-weight: 700;
    color: var(--blue-600);
    text-transform: uppercase;
    letter-spacing: 0.07em;
    border-bottom: 2px solid var(--blue-200);
    white-space: nowrap;
  }

  td {
    padding: 13px 16px;
    font-size: 14px;
    color: var(--blue-900);
    border-bottom: 1px solid var(--blue-50);
    vertical-align: middle;
  }

  tbody tr {
    transition: background 0.15s;
  }
  tbody tr:hover { background: var(--blue-50); }
  tbody tr:last-child td { border-bottom: none; }

  .badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.04em;
  }
  .badge-vegetable { background: #dcfce7; color: #166534; }
  .badge-process { background: #fef9c3; color: #854d0e; }
  .badge-seafood { background: #dbeafe; color: #1e40af; }
  .badge-normal { background: #dcfce7; color: #166534; }
  .badge-low { background: #fef3c7; color: #92400e; }
  .badge-outstock { background: #fee2e2; color: #991b1b; }

  .qty-cell { font-family: 'Prompt', sans-serif; font-weight: 600; }

  .btn-qty {
    width: 28px; height: 28px;
    border-radius: 7px;
    border: 1.5px solid var(--blue-200);
    background: var(--blue-50);
    color: var(--blue-600);
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
    flex-shrink: 0;
    line-height: 1;
  }
  .btn-qty:hover { background: var(--blue-200); border-color: var(--blue-400); transform: scale(1.1); }
  .btn-qty:active { transform: scale(0.95); }
  .btn-qty.plus { border-color: var(--blue-300); background: var(--blue-100); color: var(--blue-700); }
  .btn-qty.plus:hover { background: var(--blue-300); }

  .action-btns { display: flex; gap: 7px; }

  .btn-edit, .btn-del {
    border: none;
    border-radius: var(--radius-xs);
    padding: 6px 12px;
    font-family: 'Sarabun', sans-serif;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex; align-items: center; gap: 4px;
  }
  .btn-edit {
    background: var(--blue-100);
    color: var(--blue-700);
    border: 1px solid var(--blue-200);
  }
  .btn-edit:hover { background: var(--blue-200); transform: translateY(-1px); }
  .btn-del {
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fecaca;
  }
  .btn-del:hover { background: #fecaca; transform: translateY(-1px); }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--blue-300);
  }
  .empty-state svg { margin-bottom: 12px; opacity: 0.4; }
  .empty-state p { font-size: 15px; }

  /* MODALS */
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(30,58,138,0.35);
    backdrop-filter: blur(4px);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
    animation: fadeIn 0.2s ease;
  }

  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes slideUp { from { opacity: 0; transform: translateY(24px) scale(0.97); } to { opacity: 1; transform: translateY(0) scale(1); } }

  .modal {
    background: #fff;
    border-radius: var(--radius);
    box-shadow: var(--shadow-xl);
    width: 100%;
    max-width: 480px;
    max-height: 90vh;
    overflow-y: auto;
    animation: slideUp 0.25s ease;
    border: 1.5px solid var(--blue-100);
  }

  .modal-header {
    padding: 20px 24px 16px;
    border-bottom: 1.5px solid var(--blue-100);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .modal-header h3 {
    font-family: 'Prompt', sans-serif;
    font-size: 17px;
    font-weight: 600;
    color: var(--blue-800);
  }

  .btn-close {
    background: var(--blue-100);
    border: none;
    width: 32px; height: 32px;
    border-radius: 8px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    color: var(--blue-500);
    font-size: 18px;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .btn-close:hover { background: var(--blue-200); }

  .modal-body { padding: 20px 24px; }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
    margin-bottom: 16px;
  }

  .form-group label {
    font-size: 12px;
    font-weight: 700;
    color: var(--blue-600);
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .form-input, .form-select {
    border: 1.5px solid var(--blue-200);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    color: var(--blue-900);
    background: var(--blue-50);
    outline: none;
    transition: all 0.2s;
  }
  .form-input:focus, .form-select:focus {
    border-color: var(--blue-400);
    box-shadow: 0 0 0 3px rgba(96,165,250,0.2);
    background: #fff;
  }

  .modal-footer {
    padding: 16px 24px;
    border-top: 1.5px solid var(--blue-100);
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  .btn-save {
    background: linear-gradient(135deg, var(--blue-500), var(--blue-700));
    color: #fff;
    border: none;
    border-radius: var(--radius-sm);
    padding: 10px 24px;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s;
  }
  .btn-save:hover { opacity: 0.9; transform: translateY(-1px); }

  .btn-cancel {
    background: var(--blue-100);
    color: var(--blue-600);
    border: 1.5px solid var(--blue-200);
    border-radius: var(--radius-sm);
    padding: 10px 20px;
    font-family: 'Sarabun', sans-serif;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-cancel:hover { background: var(--blue-200); }

  /* TOAST */
  #toast-container {
    position: fixed;
    bottom: 24px;
    right: 24px;
    z-index: 999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none;
  }

  .toast {
    background: var(--blue-800);
    color: #fff;
    padding: 12px 20px;
    border-radius: var(--radius-sm);
    font-size: 14px;
    font-weight: 500;
    box-shadow: var(--shadow-xl);
    animation: toastIn 0.3s ease forwards;
    max-width: 320px;
    pointer-events: all;
  }
  .toast.success { background: #16a34a; }
  .toast.warning { background: #d97706; }
  .toast.error { background: #dc2626; }

  @keyframes toastIn {
    from { opacity: 0; transform: translateX(60px); }
    to { opacity: 1; transform: translateX(0); }
  }
  @keyframes toastOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(60px); }
  }

  /* DELETE CONFIRM MODAL */
  .delete-confirm-input {
    margin-top: 12px;
  }
  .delete-confirm-hint {
    font-size: 12px;
    color: #dc2626;
    margin-bottom: 8px;
  }

  /* GOOGLE SHEETS STATUS */
  .gs-status {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    color: rgba(255,255,255,0.7);
    padding: 4px 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    border: 1px solid rgba(255,255,255,0.2);
  }
  .gs-dot {
    width: 7px; height: 7px;
    border-radius: 50%;
    background: #4ade80;
    box-shadow: 0 0 6px #4ade80;
    animation: pulse 2s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

  .config-btn {
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.25);
    color: rgba(255,255,255,0.8);
    border-radius: 7px;
    padding: 4px 10px;
    font-size: 11px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .config-btn:hover { background: rgba(255,255,255,0.2); }

  .header-right {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
  }

  @media (max-width: 600px) {
    .gs-status span { display: none; }
    .header-title span.title-text { display: none; }
    th, td { padding: 10px 10px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <div class="header-title">
      <div class="icon">üì¶</div>
      <span class="title-text">Stock ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</span>
    </div>
    <div class="header-right">
      <div class="gs-status" id="gs-status-badge">
        <div class="gs-dot"></div>
        <span>Google Sheets</span>
      </div>
      <button class="config-btn" onclick="openConfig()">‚öô ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
      <button class="btn-add-main" onclick="openAddModal()">
        <span>Ôºã</span> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö
      </button>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="main">
  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-label">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      <div class="stat-value" id="stat-total">0</div>
    </div>
    <div class="stat-card normal">
      <div class="stat-label">‡∏õ‡∏Å‡∏ï‡∏¥</div>
      <div class="stat-value" id="stat-normal">0</div>
    </div>
    <div class="stat-card low">
      <div class="stat-label">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
      <div class="stat-value" id="stat-low">0</div>
    </div>
    <div class="stat-card outstock">
      <div class="stat-label">‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</div>
      <div class="stat-value" id="stat-outstock">0</div>
    </div>
  </div>

  <!-- SEARCH -->
  <div class="search-panel">
    <div class="search-panel-title">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</div>
    <div class="search-row">
      <div class="search-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</label>
        <input type="text" class="search-input" id="s-name" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠..." oninput="doSearch()">
      </div>
      <div class="search-group">
        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
        <select class="search-select" id="s-type" onchange="doSearch()">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="vegetable">ü•¨ Vegetable</option>
          <option value="process">üßÇ Process</option>
          <option value="seafood">ü¶ê Seafood</option>
        </select>
      </div>
      <div class="search-group">
        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
        <select class="search-select" id="s-status" onchange="doSearch()">
          <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
          <option value="normal">‚úÖ Normal</option>
          <option value="low">‚ö†Ô∏è Low</option>
          <option value="outstock">‚ùå Out of Stock</option>
        </select>
      </div>
      <button class="btn-clear" onclick="clearSearch()">‚úï ‡∏•‡πâ‡∏≤‡∏á</button>
    </div>
  </div>

  <!-- TABLE -->
  <div class="table-panel">
    <div class="table-header-bar">
      <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h2>
      <div class="result-count" id="result-count">‡πÅ‡∏™‡∏î‡∏á 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
    </div>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</th>
            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
            <th>‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
            <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th>‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="stock-tbody"></tbody>
      </table>
    </div>
  </div>
</main>

<!-- ADD/EDIT MODAL -->
<div class="overlay" id="form-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h3 id="form-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</h3>
      <button class="btn-close" onclick="closeFormModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö *</label>
        <input type="text" class="form-input" id="f-name" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®">
      </div>
      <div class="form-group">
        <label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label>
        <select class="form-select" id="f-type">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
          <option value="vegetable">ü•¨ Vegetable</option>
          <option value="process">üßÇ Process</option>
          <option value="seafood">ü¶ê Seafood</option>
        </select>
      </div>
      <div class="form-group">
        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label>
        <input type="number" class="form-input" id="f-qty" placeholder="0" min="0">
      </div>
      <div class="form-group">
        <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢ *</label>
        <input type="text" class="form-input" id="f-unit" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏Å., ‡∏•‡∏¥‡∏ï‡∏£, ‡∏ñ‡∏∏‡∏á">
      </div>
      <div class="form-group">
        <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ *</label>
        <select class="form-select" id="f-status">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
          <option value="normal">‚úÖ Normal</option>
          <option value="low">‚ö†Ô∏è Low</option>
          <option value="outstock">‚ùå Out of Stock</option>
        </select>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeFormModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn-save" onclick="saveForm()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
    </div>
  </div>
</div>

<!-- DELETE MODAL -->
<div class="overlay" id="delete-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h3>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö</h3>
      <button class="btn-close" onclick="closeDeleteModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <p style="color:#dc2626;font-weight:600;margin-bottom:12px">‚ö†Ô∏è ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏•‡∏ö "<span id="del-name-display" style="font-weight:700"></span>"</p>
      <p style="font-size:13px;color:var(--blue-600)">‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</p>
      <div class="form-group delete-confirm-input">
        <label>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠ "<span id="del-name-hint" style="color:#dc2626"></span>" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</label>
        <input type="text" class="form-input" id="del-confirm-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà...">
        <div class="delete-confirm-hint" id="del-error" style="display:none">‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeDeleteModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn-save" style="background:linear-gradient(135deg,#ef4444,#dc2626)" onclick="confirmDelete()">üóë ‡∏•‡∏ö</button>
    </div>
  </div>
</div>

<!-- CONFIG MODAL -->
<div class="overlay" id="config-overlay" style="display:none">
  <div class="modal">
    <div class="modal-header">
      <h3>‚öô ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Google Sheets</h3>
      <button class="btn-close" onclick="closeConfig()">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label>Google Apps Script URL</label>
        <input type="text" class="form-input" id="cfg-url" placeholder="https://script.google.com/macros/s/.../exec">
      </div>
      <p style="font-size:12px;color:var(--blue-500);background:var(--blue-50);padding:12px;border-radius:8px;border:1px solid var(--blue-200)">
        üìå ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤: ‡∏™‡∏£‡πâ‡∏≤‡∏á Google Apps Script ‡πÅ‡∏•‡πâ‡∏ß Deploy ‡πÄ‡∏õ‡πá‡∏ô Web App ‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏ô‡∏≥ URL ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á Google Sheets ‡πÑ‡∏î‡πâ
      </p>
    </div>
    <div class="modal-footer">
      <button class="btn-cancel" onclick="closeConfig()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
      <button class="btn-save" onclick="saveConfig()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
    </div>
  </div>
</div>

<!-- TOAST -->
<div id="toast-container"></div>

<script>
// ============================================
// DATA STORE
// ============================================
let stockData = [];
let filteredData = [];
let editIndex = null;
let deleteIndex = null;
let gsUrl = '';

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
const DEMO_DATA = [];

// ============================================
// INIT
// ============================================
window.onload = () => {
  const saved = localStorage.getItem('stockData');
  gsUrl = localStorage.getItem('gsUrl') || '';
  if (saved) {
    try {
      const parsed = JSON.parse(saved);
      const demoNames = ['‡∏°‡∏∞‡πÄ‡∏Ç‡∏∑‡∏≠‡πÄ‡∏ó‡∏®','‡∏Å‡∏∏‡πâ‡∏á‡πÅ‡∏ä‡πà‡πÅ‡∏Ç‡πá‡∏á','‡∏ã‡∏≠‡∏™‡∏õ‡∏£‡∏∏‡∏á‡∏£‡∏™','‡∏ú‡∏±‡∏Å‡∏ö‡∏∏‡πâ‡∏á','‡∏õ‡∏•‡∏≤‡∏´‡∏°‡∏∂‡∏Å'];
      const isDemoOnly = parsed.length > 0 && parsed.every(i => demoNames.includes(i.name));
      stockData = isDemoOnly ? [] : parsed;
      if (isDemoOnly) localStorage.removeItem('stockData');
    } catch { stockData = []; }
  } else {
    stockData = [];
  }
  if (gsUrl) document.getElementById('cfg-url').value = gsUrl;
  renderAll();
};

function saveLocal() {
  localStorage.setItem('stockData', JSON.stringify(stockData));
}

// ============================================
// GOOGLE SHEETS SYNC
// ============================================
async function syncToGoogleSheets(action, payload) {
  if (!gsUrl) return;
  try {
    const body = { action, data: payload, timestamp: new Date().toISOString() };
    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô array of objects ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
    await fetch(gsUrl, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
  } catch (e) {
    console.warn('Google Sheets sync failed:', e);
  }
}

// ============================================
// RENDER
// ============================================
function renderAll() {
  doSearch();
  updateStats();
}

function updateStats() {
  document.getElementById('stat-total').textContent = stockData.length;
  document.getElementById('stat-normal').textContent = stockData.filter(i => i.status === 'normal').length;
  document.getElementById('stat-low').textContent = stockData.filter(i => i.status === 'low').length;
  document.getElementById('stat-outstock').textContent = stockData.filter(i => i.status === 'outstock').length;
}

function renderTable(data) {
  const tbody = document.getElementById('stock-tbody');
  document.getElementById('result-count').textContent = `‡πÅ‡∏™‡∏î‡∏á ${data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;

  if (data.length === 0) {
    tbody.innerHTML = `<tr><td colspan="8">
      <div class="empty-state">
        <div style="font-size:48px;margin-bottom:12px">üì≠</div>
        <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö</p>
      </div>
    </td></tr>`;
    return;
  }

  tbody.innerHTML = data.map((item, idx) => {
    const realIdx = stockData.indexOf(item);
    const typeBadge = { vegetable: 'badge-vegetable', process: 'badge-process', seafood: 'badge-seafood' };
    const statusBadge = { normal: 'badge-normal', low: 'badge-low', outstock: 'badge-outstock' };
    const typeLabel = { vegetable: 'ü•¨ Vegetable', process: 'üßÇ Process', seafood: 'ü¶ê Seafood' };
    const statusLabel = { normal: '‚úÖ Normal', low: '‚ö†Ô∏è Low', outstock: '‚ùå Out of Stock' };

    return `<tr>
      <td style="color:var(--blue-400);font-weight:500">${idx + 1}</td>
      <td><strong>${escapeHtml(item.name)}</strong></td>
      <td><span class="badge ${typeBadge[item.type] || ''}">${typeLabel[item.type] || item.type}</span></td>
      <td>
        <div style="display:flex;align-items:center;gap:6px">
          <button class="btn-qty" onclick="changeQty(${realIdx}, -1)">‚àí</button>
          <span class="qty-cell" style="min-width:34px;text-align:center;display:inline-block">${item.qty}</span>
          <button class="btn-qty plus" onclick="changeQty(${realIdx}, 1)">Ôºã</button>
        </div>
      </td>
      <td>${escapeHtml(item.unit)}</td>
      <td><span class="badge ${statusBadge[item.status] || ''}">${statusLabel[item.status] || item.status}</span></td>
      <td style="font-size:12px;color:var(--blue-400)">${item.updatedAt || '-'}</td>
      <td>
        <div class="action-btns">
          <button class="btn-edit" onclick="openEditModal(${realIdx})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn-del" onclick="openDeleteModal(${realIdx})">üóë ‡∏•‡∏ö</button>
        </div>
      </td>
    </tr>`;
  }).join('');
}

function changeQty(idx, delta) {
  const item = stockData[idx];
  if (!item) return;
  const newQty = Math.max(0, item.qty + delta);
  item.qty = newQty;
  item.updatedAt = new Date().toISOString().split('T')[0];
  saveLocal();
  syncToGoogleSheets('update', stockData);
  renderAll();
}

function escapeHtml(str) {
  return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// ============================================
// SEARCH
// ============================================
function doSearch() {
  const name = document.getElementById('s-name').value.toLowerCase().trim();
  const type = document.getElementById('s-type').value;
  const status = document.getElementById('s-status').value;

  filteredData = stockData.filter(item => {
    const matchName = !name || item.name.toLowerCase().includes(name);
    const matchType = !type || item.type === type;
    const matchStatus = !status || item.status === status;
    return matchName && matchType && matchStatus;
  });

  renderTable(filteredData);
}

function clearSearch() {
  document.getElementById('s-name').value = '';
  document.getElementById('s-type').value = '';
  document.getElementById('s-status').value = '';
  doSearch();
}

// ============================================
// ADD MODAL
// ============================================
function openAddModal() {
  editIndex = null;
  document.getElementById('form-title').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏î‡∏¥‡∏ö';
  document.getElementById('f-name').value = '';
  document.getElementById('f-type').value = '';
  document.getElementById('f-qty').value = '';
  document.getElementById('f-unit').value = '';
  document.getElementById('f-status').value = '';
  document.getElementById('form-overlay').style.display = 'flex';
}

function openEditModal(idx) {
  const item = stockData[idx];
  if (!item) return;

  const confirmed = confirm(`‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• "${item.name}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`);
  if (!confirmed) return;

  editIndex = idx;
  document.getElementById('form-title').textContent = `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ${item.name}`;
  document.getElementById('f-name').value = item.name;
  document.getElementById('f-type').value = item.type;
  document.getElementById('f-qty').value = item.qty;
  document.getElementById('f-unit').value = item.unit;
  document.getElementById('f-status').value = item.status;
  document.getElementById('form-overlay').style.display = 'flex';
}

function closeFormModal() {
  document.getElementById('form-overlay').style.display = 'none';
}

function saveForm() {
  const name = document.getElementById('f-name').value.trim();
  const type = document.getElementById('f-type').value;
  const qty = document.getElementById('f-qty').value;
  const unit = document.getElementById('f-unit').value.trim();
  const status = document.getElementById('f-status').value;

  if (!name || !type || qty === '' || !unit || !status) {
    showToast('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á', 'warning');
    return;
  }

  const today = new Date().toISOString().split('T')[0];
  const payload = { name, type, qty: Number(qty), unit, status, updatedAt: today };

  if (editIndex !== null) {
    // EDIT MODE
    stockData[editIndex] = payload;
    showToast(`‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç "${name}" ‡πÅ‡∏•‡πâ‡∏ß`, 'success');
    syncToGoogleSheets('update', stockData);
  } else {
    // ADD MODE
    const exists = stockData.find(i => i.name.toLowerCase() === name.toLowerCase());
    if (exists) {
      showToast(`‚ÑπÔ∏è "${name}" ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô stock ‡πÅ‡∏•‡πâ‡∏ß`, 'warning');
      return;
    }
    stockData.push(payload);
    showToast(`‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
    syncToGoogleSheets('add', stockData);
  }

  saveLocal();
  closeFormModal();
  renderAll();
}

// ============================================
// DELETE
// ============================================
function openDeleteModal(idx) {
  deleteIndex = idx;
  const name = stockData[idx].name;
  document.getElementById('del-name-display').textContent = name;
  document.getElementById('del-name-hint').textContent = name;
  document.getElementById('del-confirm-input').value = '';
  document.getElementById('del-error').style.display = 'none';
  document.getElementById('delete-overlay').style.display = 'flex';
}

function closeDeleteModal() {
  document.getElementById('delete-overlay').style.display = 'none';
  deleteIndex = null;
}

function confirmDelete() {
  const typed = document.getElementById('del-confirm-input').value.trim();
  const expected = stockData[deleteIndex]?.name;

  if (typed !== expected) {
    document.getElementById('del-error').style.display = 'block';
    return;
  }

  const name = expected;
  stockData.splice(deleteIndex, 1);
  saveLocal();
  syncToGoogleSheets('delete', stockData);
  closeDeleteModal();
  renderAll();
  showToast(`üóë ‡∏•‡∏ö "${name}" ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'error');
}

// ============================================
// CONFIG
// ============================================
function openConfig() {
  document.getElementById('cfg-url').value = gsUrl;
  document.getElementById('config-overlay').style.display = 'flex';
}

function closeConfig() {
  document.getElementById('config-overlay').style.display = 'none';
}

function saveConfig() {
  gsUrl = document.getElementById('cfg-url').value.trim();
  localStorage.setItem('gsUrl', gsUrl);
  showToast('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß', 'success');
  closeConfig();
}

// ============================================
// TOAST
// ============================================
function showToast(msg, type = '') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = msg;
  container.appendChild(toast);
  setTimeout(() => {
    toast.style.animation = 'toastOut 0.3s ease forwards';
    setTimeout(() => toast.remove(), 300);
  }, 3200);
}

// Close overlay on background click
document.getElementById('form-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeFormModal();
});
document.getElementById('delete-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeDeleteModal();
});
document.getElementById('config-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeConfig();
});
</script>
</body>
</html>
